"use strict";angular.module("arma3SpotterApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","pascalprecht.translate"]),function(){function a(a){a.translations("en",{SETTINGS:"Settings",SETTINGS_MOD:"Mod",SETTING_WEAPON:"Weapon",SETTINGS_AMMO:"Ammo",SETTINGS_SAVE:"Save",SPOTTER:"Spotter",SPOTTER_DISTANCE:"Distance",SPOTTER_ANGLE:"Angle",SPOTTER_HEADWIND:"Headwind",SPOTTER_CROSSWIND:"Crosswind",SPOTTER_TEMPERATURE:"Temperature",SPOTTER_CALCULATE:"Calculate",SPOTTER_HORIZONTAL:"Horizontal",SPOTTER_VERTICAL:"Vertical"}).translations("de",{SETTINGS:"Einstellungen",SETTINGS_MOD:"Mod",SETTING_WEAPON:"Waffe",SETTINGS_AMMO:"Munition",SETTINGS_SAVE:"Speichern",SPOTTER:"Spotter",SPOTTER_DISTANCE:"Entfernung",SPOTTER_ANGLE:"Winkel",SPOTTER_HEADWIND:"Gegenwind",SPOTTER_CROSSWIND:"Seitenwind",SPOTTER_TEMPERATURE:"Temperatur",SPOTTER_CALCULATE:"Berechnen",SPOTTER_HORIZONTAL:"Horizontal",SPOTTER_VERTICAL:"Vertikal"}).registerAvailableLanguageKeys(["en","de"],{en_US:"en",en_UK:"en",en_GB:"en",de_DE:"de",de_AT:"de",de_CH:"de"}).determinePreferredLanguage().fallbackLanguage("en")}angular.module("arma3SpotterApp").config(a),a.$inject=["$translateProvider"]}(),function(){function a(a,b,c,d){function e(){return b.getWeapons().then(function(a){return m.allWeapons=a,m.allWeapons.forEach(function(a){-1===m.mods.indexOf(a.mod)&&m.mods.push(a.mod)}),m.mods.sort(function(a,b){return a>b?1:-1}),i(),m.allWeapons})}function f(){d.setActiveWeapon(m.activeWeapon),d.setActiveAmmo(m.activeAmmo)}function g(){m.weapons=[],m.allWeapons.forEach(function(a){a.mod===m.activeMod&&m.weapons.push(a)}),m.weapons.sort(function(a,b){return a.name>b.name?1:-1}),j()}function h(){var a=c.getItem("activeAmmo");if(a&&""!==a){for(var b=!1,d=0;d<m.ammos.length;d++)if(m.ammos[d].name===a){m.activeAmmo=m.ammos[d],b=!0;break}b===!1&&(m.activeAmmo=m.ammos[0])}else m.activeAmmo=m.ammos[0];f()}function i(){var a=c.getItem("activeMod");if(a&&""!==a){var b=m.mods.indexOf(a);m.activeMod=b>=0&&m.mods.length>b?m.mods[b]:m.mods[0]}else m.activeMod=m.mods[0];g()}function j(){var a=c.getItem("activeWeapon");if(a&&""!==a){for(var b=!1,d=0;d<m.weapons.length;d++)if(m.weapons[d].name===a){m.activeWeapon=m.weapons[d],b=!0;break}b===!1&&(m.activeWeapon=m.weapons[0])}else m.activeWeapon=m.weapons[0];k()}function k(){m.ammos=m.activeWeapon.magazines,m.ammos.sort(function(a,b){return a.name>b.name?1:-1}),h()}function l(){c.setItem("activeMod",m.activeMod),c.setItem("activeWeapon",m.activeWeapon.name),c.setItem("activeAmmo",m.activeAmmo.name)}var m=this;m.activeAmmo="",m.activeMod="",m.activeWeapon="",m.allWeapons=[],m.ammoChanged=f,m.ammos=[],m.modChanged=g,m.mods=[],m.saveConfig=l,m.weaponChanged=k,m.weapons=[],e()}angular.module("arma3SpotterApp").controller("SettingsCtrl",a),a.$inject=["$scope","DataService","StorageService","Data"]}(),function(){function a(a,b){function c(){var a=h.Data.getActiveAmmo(),b=Math.min(Math.max(parseInt(h.distance),1),3e3),c=Math.min(Math.max(parseInt(h.angle),0),360),d=Math.min(Math.max(parseFloat(h.headwind),-15),15),e=Math.min(Math.max(parseFloat(h.crosswind),-15),15),f=Math.min(Math.max(parseFloat(h.temperature),-50),50),i=g(a,b,c,d,e,45);if(i[0]<0)return h.resultHorizontal=0,void(h.resultVertical=0);var j=c,k=45;i=g(a,b,c,d,e,f,j);for(var l,m,n=i[0],o=i[1];Math.abs(n)>.1;)i=g(a,b,c,d,e,f,k),l=i[0],o=i[1],m=k-l*(k-j)/(l-n),j=k,k=m,n=l;try{var p=17.77777*(j-c);if(p=Math.round(10*p)/10,isNaN(p))throw"HairOnFire";h.resultVertical=p}catch(q){h.resultVertical=0}try{var r=Math.atan(o/b)*(180/Math.PI)*17.77777;if(r=Math.round(10*r)/10,isNaN(r))throw"HairOnFire";h.resultHorizontal=r}catch(q){h.resultHorizontal=0}}function d(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2))}function e(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]}function f(a,b){return[a[0]*b,a[1]*b,a[2]*b]}function g(a,b,c,g,h,i,j){var k=a.initSpeed,l=a.airFriction,m=a.timeToLive,n=a.simulationStep,o=293.15/(273.15+i);j*=Math.PI/180,c*=Math.PI/180,g*=-1;var p=[Math.cos(c)*b,Math.sin(c)*b,0],q=[0,0,0],r=k*(((i+273.13)/288.13-1)/2.5+1-1),s=[Math.cos(j)*(k+r),Math.sin(j)*(k+r),0];n=Math.min(n,.001);for(var t=Math.floor(m/n),u=0;t>u;u++){var v=d(s);if(s[0]+=n*s[0]*v*l,s[1]+=n*(s[1]*v*l-9.81),s[2]+=n*s[2]*v*l,s=e(e(s,f(s,v*(o-1)*l*n)),f([g,0,h],-1*d(e(s,[g,0,h]))*l*n)),q=e(q,f(s,n)),q[0]>=p[0])break}return[q[1]-p[1],q[2]]}var h=this;h.angle=0,h.calculate=c,h.crosswind=0,h.Data=b,h.distance=1e3,h.headwind=0,h.temperature=30,h.resultHorizontal=0,h.resultVertical=0}angular.module("arma3SpotterApp").controller("CalculationCtrl",a),a.$inject=["$scope","Data"]}(),function(){function a(a,b){function c(){return a.get("data/weapons.json").then(d).catch(e)}function d(a){return a.data}function e(a){b.logError("XHR failed for getWeapons."+a.data)}return{getWeapons:c}}angular.module("arma3SpotterApp").factory("DataService",a),a.$inject=["$http","logger"]}(),function(){function a(){return{logError:function(a){console.log(a)}}}angular.module("arma3SpotterApp").service("logger",a)}(),function(){function a(){function a(a){if(!a||""===a)throw new Error("StorageService.getItem: Key is empty!");var b=localStorage.getItem(a);if(b&&""!==b){var c=JSON.parse(b);return c.item}return null}function b(a,b){if(!a||""===a)throw new Error("StorageService.setItem: Key is empty!");if(!b)throw new Error("StorageService.setItem: Item is null!");"object"==typeof b?localStorage.setItem(a,JSON.stringify({type:"object",item:b})):"string"==typeof b&&localStorage.setItem(a,JSON.stringify({type:"string",item:b}))}return{getItem:a,setItem:b}}angular.module("arma3SpotterApp").factory("StorageService",a)}(),function(){angular.module("arma3SpotterApp").factory("Data",function(){function a(){return e.activeAmmo}function b(){return e.activeWeapon}function c(a){a&&"object"==typeof a&&(e.activeAmmo=a)}function d(a){a&&"object"==typeof a&&(e.activeWeapon=a)}var e={activeWeapon:null,activeAmmo:null};return{getActiveAmmo:a,getActiveWeapon:b,setActiveAmmo:c,setActiveWeapon:d}})}();